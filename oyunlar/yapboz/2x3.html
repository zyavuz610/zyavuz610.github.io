<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pekünlü Merkez Pide - Yapboz Oyunu</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            overflow: hidden; /* Sayfa kaymasını engelle */
        }

        h1 {
            color: #d35400;
            margin: 10px 0;
            font-size: 24px;
            text-align: center;
        }

        /* Üst Bilgi Paneli */
        #info-panel {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        #timer {
            color: #e74c3c;
            background: white;
            padding: 5px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
            max-width: 600px;
        }

        /* Yapboz Tahtası */
        #puzzle-board {
            display: grid;
            /* Grid yapısı JS ile ayarlanacak */
            width: 100%;
            max-width: 600px; 
            /* En boy oranı 5:3 (Logoya uygun) */
            aspect-ratio: 5 / 3; 
            border: 3px solid #2c3e50;
            background-color: #ecf0f1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        /* Tahta arka planı (referans için soluk resim) */
        #puzzle-board::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('logo.jpg');
            background-size: cover;
            opacity: 0.1; /* Çok silik referans resim */
            pointer-events: none;
            z-index: 0;
        }

        .slot {
            border: 1px dashed #bdc3c7;
            position: relative;
            z-index: 1;
            box-sizing: border-box;
        }

        /* Parçalar Alanı */
        #pieces-pool {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            width: 100%;
            min-height: 120px;
            padding: 10px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #ccc;
            overflow-y: auto;
            max-height: 200px;
        }

        /* Yapboz Parçası */
        .piece {
            /* Boyutlar JS ile atanacak */
            background-image: url('logo.jpg');
            cursor: grab;
            transition: transform 0.1s, box-shadow 0.1s;
            touch-action: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .piece:active {
            cursor: grabbing;
            transform: scale(1.1);
            z-index: 1000;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            outline: 2px solid #d35400;
        }

        /* ---- MODAL EKRANLARI (Başlangıç ve Bitiş) ---- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            max-width: 90%;
        }

        .btn {
            background: #e67e22;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.2s;
            font-weight: bold;
        }

        .btn:hover {
            background: #d35400;
        }

        .btn-hard {
            background: #c0392b;
        }
        .btn-hard:hover {
            background: #a93226;
        }

        #game-screen {
            display: none; /* Başlangıçta gizli */
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Gizleme sınıfı */
        .hidden {
            display: none !important;
        }

    </style>
</head>
<body>

    <div id="start-screen" class="modal">
        <div class="modal-content">
            <h1 style="color:#2c3e50;">Pekünlü Merkez Pide</h1>
            <p>Lütfen oyun zorluğunu seçiniz:</p>
            <button class="btn" onclick="startGame(2, 3)">Kolay (2x3)</button>
            <button class="btn btn-hard" onclick="startGame(4, 6)">Zor (4x6)</button>
        </div>
    </div>

    <div id="game-ui" class="hidden">
        <h1>Pekünlü Merkez Pide Yapboz</h1>
        
        <div id="info-panel">
            <span>Süre: <span id="timer">02:00</span></span>
        </div>

        <div class="game-area">
            <div id="puzzle-board"></div>
            <div id="pieces-pool"></div>
        </div>
        
        <button class="btn" onclick="location.reload()" style="font-size: 14px; padding: 10px; margin-top:10px; background:#7f8c8d;">Ana Menüye Dön</button>
    </div>

    <div id="result-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="modal-title">Tebrikler!</h2>
            <p id="modal-message">Oyunu kazandınız.</p>
            <button class="btn" onclick="location.reload()">Tekrar Oyna</button>
        </div>
    </div>

    <script>
        // DEĞİŞKENLER
        let ROWS, COLS;
        const TIME_LIMIT = 120; // 2 Dakika
        let timerInterval;
        let isGameActive = false;
        
        // Elementler
        const boardEl = document.getElementById('puzzle-board');
        const poolEl = document.getElementById('pieces-pool');
        const timerEl = document.getElementById('timer');
        const startScreen = document.getElementById('start-screen');
        const gameUI = document.getElementById('game-ui');
        const resultModal = document.getElementById('result-modal');
        
        let draggedPiece = null;

        // Oyunu Başlatma Fonksiyonu (Seviye Seçimi ile tetiklenir)
        function startGame(r, c) {
            ROWS = r;
            COLS = c;
            
            // Arayüz geçişi
            startScreen.classList.add('hidden');
            gameUI.classList.remove('hidden');
            gameUI.style.display = 'flex'; // Flex yapısını korumak için

            // Izgara Ayarları
            boardEl.style.gridTemplateRows = `repeat(${ROWS}, 1fr)`;
            boardEl.style.gridTemplateColumns = `repeat(${COLS}, 1fr)`;

            initBoard();
        }

        function initBoard() {
            isGameActive = true;
            let pieces = [];
            
            // Tahtanın güncel boyutlarını al (Responsive hesaplama için)
            const boardWidth = boardEl.clientWidth;
            const boardHeight = boardEl.clientHeight;

            // Slotları Oluştur
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    let slot = document.createElement('div');
                    slot.classList.add('slot');
                    slot.dataset.expected = `piece-${r}-${c}`;
                    
                    // Sürükle-Bırak olayları
                    slot.addEventListener('dragover', handleDragOver);
                    slot.addEventListener('drop', handleDrop);
                    
                    boardEl.appendChild(slot);
                }
            }

            // Parçaları Oluştur
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    let piece = document.createElement('div');
                    piece.classList.add('piece');
                    piece.id = `piece-${r}-${c}`;
                    piece.draggable = true;
                    
                    // -- DİNAMİK BOYUTLANDIRMA --
                    // Her parçanın genişliği tahtanın genişliği / sütun sayısıdır.
                    // Yüzdelik kullanmak daha sağlıklı olur.
                    piece.style.width = (boardWidth / COLS) + 'px';
                    piece.style.height = (boardHeight / ROWS) + 'px';
                    
                    // Arka plan pozisyonu (Resmin hangi kısmını gösterecek)
                    let posX = (c / (COLS - 1)) * 100;
                    let posY = (r / (ROWS - 1)) * 100;
                    
                    // Eğer sadece 1 satır veya 1 sütun varsa (örn: 1x3) sıfıra bölme hatasını önle
                    if (COLS === 1) posX = 0;
                    if (ROWS === 1) posY = 0;

                    piece.style.backgroundPosition = `${posX}% ${posY}%`;
                    
                    // Arka plan boyutu TAHTA boyutu kadar olmalı
                    piece.style.backgroundSize = `${boardWidth}px ${boardHeight}px`;

                    // Olay Dinleyicileri
                    piece.addEventListener('dragstart', handleDragStart);
                    piece.addEventListener('touchstart', handleTouchStart, {passive: false});
                    piece.addEventListener('touchmove', handleTouchMove, {passive: false});
                    piece.addEventListener('touchend', handleTouchEnd);

                    pieces.push(piece);
                }
            }

            // Parçaları karıştır
            pieces.sort(() => Math.random() - 0.5);
            pieces.forEach(p => poolEl.appendChild(p));

            startTimer();
        }

        // --- ZAMANLAYICI ---
        function startTimer() {
            let timeLeft = TIME_LIMIT;
            updateTimerDisplay(timeLeft);

            timerInterval = setInterval(() => {
                if (!isGameActive) return;
                timeLeft--;
                updateTimerDisplay(timeLeft);

                if (timeLeft <= 0) {
                    endGame(false);
                }
            }, 1000);
        }

        function updateTimerDisplay(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            timerEl.textContent = `${m}:${s}`;
        }

        // --- SÜRÜKLE BIRAK (Masaüstü) ---
        function handleDragStart(e) {
            if (!isGameActive) return;
            draggedPiece = e.target;
            e.dataTransfer.setData('text/plain', e.target.id);
        }

        function handleDragOver(e) {
            e.preventDefault(); 
        }

        function handleDrop(e) {
            e.preventDefault();
            if (!isGameActive) return;
            let target = e.target;
            
            // Parçanın üzerine bırakılırsa, parçanın ebeveynine (slot) odaklan
            if (target.classList.contains('piece')) {
                target = target.parentElement;
            }

            placePiece(target);
        }

        // --- DOKUNMATİK (Mobil) ---
        let touchStartPos = {};

        function handleTouchStart(e) {
            if (!isGameActive) return;
            draggedPiece = e.target;
            let touch = e.touches[0];
            
            // Mobilde sürüklerken parçayı absolute yapıp parmağı takip ettiriyoruz
            draggedPiece.style.position = 'fixed';
            draggedPiece.style.zIndex = '500';
            draggedPiece.style.pointerEvents = 'none'; // Altındaki elemanı algılayabilmek için
            
            moveAt(touch.clientX, touch.clientY);
        }

        function moveAt(pageX, pageY) {
            draggedPiece.style.left = pageX - (draggedPiece.offsetWidth / 2) + 'px';
            draggedPiece.style.top = pageY - (draggedPiece.offsetHeight / 2) + 'px';
        }

        function handleTouchMove(e) {
            if (!isGameActive) return;
            e.preventDefault();
            let touch = e.touches[0];
            moveAt(touch.clientX, touch.clientY);
        }

        function handleTouchEnd(e) {
            if (!isGameActive) return;
            let touch = e.changedTouches[0];
            
            // Parmağın altındaki öğeyi bul
            // pointer-events:none sayesinde parçanın kendisini değil, altındakini görürüz
            let dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
            
            // Stilleri temizle
            draggedPiece.style.position = '';
            draggedPiece.style.zIndex = '';
            draggedPiece.style.left = '';
            draggedPiece.style.top = '';
            draggedPiece.style.pointerEvents = 'auto';

            if (dropTarget) {
                 if (dropTarget.classList.contains('piece')) {
                    dropTarget = dropTarget.parentElement;
                }
                placePiece(dropTarget);
            }
            draggedPiece = null;
        }

        // --- ORTAK YERLEŞTİRME MANTIĞI ---
        function placePiece(target) {
            // Hedef geçerli bir slot mu?
            if (target.classList.contains('slot')) {
                // Doluysa içindekini havuza at
                if (target.children.length > 0) {
                    poolEl.appendChild(target.children[0]);
                }
                target.appendChild(draggedPiece);
                checkWin();
            } 
            // Hedef havuz mu?
            else if (target.id === 'pieces-pool' || target.closest('#pieces-pool')) {
                poolEl.appendChild(draggedPiece);
            }
            // Geçersiz bir yerse (boşluk vs) havuza geri dönsün (opsiyonel)
            else {
                poolEl.appendChild(draggedPiece);
            }
        }

        // --- KAZANMA KONTROLÜ ---
        function checkWin() {
            let correctCount = 0;
            const slots = document.querySelectorAll('.slot');
            
            slots.forEach(slot => {
                if (slot.children.length > 0) {
                    const piece = slot.children[0];
                    if (piece.id === slot.dataset.expected) {
                        correctCount++;
                    }
                }
            });

            if (correctCount === (ROWS * COLS)) {
                setTimeout(() => endGame(true), 200);
            }
        }

        function endGame(isWin) {
            isGameActive = false;
            clearInterval(timerInterval);
            resultModal.classList.remove('hidden');
            
            const title = document.getElementById('modal-title');
            const msg = document.getElementById('modal-message');

            if (isWin) {
                title.textContent = "TEBRİKLER!";
                title.style.color = "green";
                msg.textContent = `Bulmacayı başarıyla tamamladınız!\nKalan Süre: ${timerEl.textContent}`;
            } else {
                title.textContent = "Süre Doldu!";
                title.style.color = "red";
                msg.textContent = "Maalesef zaman yetmedi.";
            }
        }
    </script>
</body>
</html>